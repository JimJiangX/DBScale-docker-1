<style>
<!--
.p-m {
	padding: 20px;
	height:100%;
}

.p-m-resource-all {
	padding: 20px 40px 20px 40px;
	height:100%;
}

.redis-counts{
	background:rgb(2, 69, 137);
	border-radius: 5px;
}

.navy-bg {
	background-color: #1ab394;
	color: #ffffff;
}

.yellow-bg {
	background-color: #f8ac59;
	color: #ffffff;
}

.lazur-bg {
	background-color: #23c6c8;
	color: #ffffff;
}

.gray-bg{
	background:rgb(243, 243, 243);
	color: #ffffff;
	border:1px solid #ccc;
}

.no-padding {
	padding: 0 !important;
	height: 290px;
}

.no-padding-title {
	padding: 0 !important;
	height: 290px;
}

.widget {
	border-radius: 5px;
	padding: 15px 20px;
	margin-bottom: 10px;
	margin-top: 10px;
	height:255px;
}

.widget .flot-chart {
	height: 100px;
}

.flot-chart {
	display: block;
	height: 200px;
}

.m-xs {
	margin: 15px 20px 30px 20px;
    text-align:center;
    border: 1px solid;
    border-radius: 30px;
}

.m-xs-noborder {
	margin: 0px 20px 30px 20px;
    text-align:center;
}

h1 {
	font-size: 30px;
}

h1, h2, h3, h4, h5, h6 {
	font-weight: 100;
}

h3{
	margin:10px 5px;
}

h4{
	margin-bottom: 25px;
	text-align:right;
}

.ibox-content {
    clear: both;
}
.ibox-content {
    background-color: #ffffff;
    color: inherit;
    padding: 15px 20px 5px 20px;
    border-color: #e7eaec;
    border-image: none;
    border-style: solid solid none;
    border-width: 1px 0px;
}
.progress-small, .progress-mini {
    margin-top: 5px;
}
.progress-small, .progress-small .progress-bar {
    height: 10px;
}

@media (min-width: 768px)
.bs-example {
    margin-right: 0;
    margin-left: 0;
    background-color: #fff;
    border-color: #ddd;
    border-width: 1px;
    border-radius: 4px 4px 0 0;
    -webkit-box-shadow: none;
    box-shadow: none;
}

.bs-example {
    position: relative;
    padding: 45px 15px 15px;
    margin: 0 -15px 15px;
    border-color: #e5e5e5 #eee #eee;
    border-style: solid;
    border-width: 1px 0;
    -webkit-box-shadow: inset 0 3px 6px rgba(0,0,0,.05);
    box-shadow: inset 0 3px 6px rgba(0,0,0,.05);
}

.bs-example>.alert:last-child, .bs-example>.form-control:last-child, .bs-example>.jumbotron:last-child, .bs-example>.list-group:last-child, .bs-example>.navbar:last-child, .bs-example>.panel:last-child, .bs-example>.progress:last-child, .bs-example>.table-responsive:last-child>.table, .bs-example>.table:last-child, .bs-example>.well:last-child, .bs-example>blockquote:last-child, .bs-example>ol:last-child, .bs-example>p:last-child, .bs-example>ul:last-child {
    margin-bottom: 0;
}
.table {
    width: 100%;
    max-width: 100%;
    margin-bottom: 20px;
}
table {
    background-color: transparent;
    border-spacing: 0;
    border-collapse: collapse;
}

.table > thead > tr > th {
    vertical-align: bottom;
    border-bottom: 2px solid #fff;
    background-color: white;
    width:18.5%;
    padding-left: 3px;
}

.table > tbody > tr > td {
    width:20%;
    padding-left: 6px;
}

.right-resource{
	height: 45px;
    margin: 10px 0 15px 0;
}

.pie-main-chart{
	width:100%;
	height:100%;
}

.span-float-right{
	float:right;
}

.alarm-info{
	width:28%;
	height:75%;
	float:left;
	padding:5px;
	margin:0 8px 0 5px;
	text-align: center;
	border-radius:10px;
    border: 1px solid;
}

.alarm-info-count{
	width: 80%;
    height: 65%;
    border-radius: 50px;
    border: 1px solid;
    text-align: center;
    line-height: 100px;
    font-size: 30px;
    margin: auto;
}

.nosend{
	background:rgb(253, 62, 62);
}
.sended{
	background:#1ab394;
}
.counts{
	background:rgb(2, 69, 137);
}
.serv_font_14{
	font-size:14px;
}
-->
</style>

<!-- widget grid -->
<section id="widget-grid" class="">
	<div class="row">
		<div id="list-alert"></div>
	</div>
	<div class="row">
		<div class="col-lg-4">
			<div class="widget navy-bg no-padding">
				<div class="p-m-resource-all">
					<h1 class="m-xs-noborder">总资源</h1>

					<h3 class="font-bold no-margins"><span><i class="fa fa-inbox"></i> CPU：<span id="cpuCountsAll">////</span></span><span class="span-float-right"><i class="fa fa-database"></i> 实例：<span id="servCountsAll">////</span></span></h3>
					<h3 class="font-bold no-margins"><span><i class="fa fa-building"></i> 内存：<span id="memCountsAll">////</span></span><span class="span-float-right"><i class="fa fa-cubes"></i> 容器：<span id="containerCountsAll">////</span></span></h3>
					<h3 class="font-bold no-margins"><span><i class="fa fa-hdd-o"></i> 存储空间：<span id="diskCountsAll">////</span></span></h3>
					<h3 class="font-bold no-margins"><span><i class="fa fa-file-text"></i> 备份空间：<span id="backfilesCountsAll">////</span></span></h3>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="widget gray-bg no-padding">
				<div class="p-m">
					<div id="pie-main-chart" class="pie-main-chart"></div>
				</div>
			</div>
		</div>
		<div class="col-lg-4">
			<div class="widget yellow-bg no-padding">
				<div class="p-m">
					<h2 class="m-xs-noborder">告警统计</h2>
					<div class="alarm-info">
						<h5>总计</h5>
						<div class="alarm-info-count counts" id="event_counts">sas</div>
					</div>
					<div class="alarm-info">
						<h5>已发送</h5>
						<div class="alarm-info-count sended" id="alarm_sended">sas</div>
					</div>
					<div class="alarm-info">
						<h5>未发送</h5>
						<div class="alarm-info-count nosend" id="alarm_nosend">sas</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row" style="margin-top:10px; background: #e3e3e3;
    padding-top: 10px;">
		<div class="col-lg-8" style="border: 0px solid #cac5c5;border-radius: 5px; margin:0 0 10px 13px;height: 273px; ">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>
						<i class="fa fa-wrench"></i> UPSQL
					</h5>
				</div>
				<div class="ibox-content">

					<table class="table scrolltable">
						<thead style="display:block;overflow-y: scroll;">
							<tr>
								<th>序号</th>
								<th>站点</th>
								<th>业务系统</th>
								<th>业务子系统</th>
								<th>服务名称</th>
								<th>服务状态</th>
							</tr>
						</thead>
						<tbody style="display:block; max-height:180px; height: 140px;overflow-y: scroll;" id="upsqlTable">
						</tbody>
					</table>

				</div>
			</div>
		</div>
		<div class="col-lg-4" style="width:32%">
			<div class="col-md-6" >
				<div class="widget lazur-bg no-padding">
					<div class="p-m">
						<h3 class="font-bold no-margins"><i class="fa fa-database"></i> 实例</h3>
						<h1 class="m-xs" id="servCountsUpsql">0</h1>
						<h3 class="font-bold no-margins"><i class="fa fa-cubes"></i> 容器</h3>
						<h1 class="m-xs" id="containerCountsUpsql">0</h1>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="ibox-content" style="border: 1px solid #cac5c5;border-radius: 5px; height: 273px; background:#e0ffff;">
					<div>
						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-inbox"></i> CPU</span>  <br><h4 class="pull-right" id="cpuCountsUpsql">0</h4>
						</div>

						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-building"></i> 内存</span> <br><h4 class="pull-right" id="memCountsUpsql">0</h4>
						</div>

						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-hdd-o"></i> 存储空间</span>  <br><h4 class="pull-right" id="diskCountsUpsql">0</h4>
						</div>

						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-file-text"></i> 备份空间</span>  <br><h4 class="pull-right" id="backfilesCountsUpsql">0</h4>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
		<div class="row" style="margin-top:10px;">
		<div class="col-lg-8" style="border: 1px solid #cac5c5;
    border-radius: 5px; margin:0 0 10px 13px;height: 273px;">
			<div class="ibox float-e-margins">
				<div class="ibox-title">
					<h5>
						<i class="fa fa-wrench"></i> UPREDIS
					</h5>
				</div>
				<div class="ibox-content">

					<table class="table scrolltable">
						<thead style="display:block;overflow-y: scroll;">
							<tr>
								<th>序号</th>
								<th>站点</th>
								<th>业务系统</th>
								<th>业务子系统</th>
								<th>服务名称</th>
								<th>服务状态</th>
							</tr>
						</thead>
						<tbody style="display:block; max-height:180px; height: 140px;overflow-y: scroll;" id="upredisTable">
						</tbody>
					</table>

				</div>
			</div>
		</div>
		<div class="col-lg-4" style="width:32%">
			<div class="col-md-6" >
				<div class="widget lazur-bg no-padding">
					<div class="p-m redis-counts">
						<h3 class="font-bold no-margins"><i class="fa fa-database"></i> 实例</h3>
						<h1 class="m-xs" id="servCountsRedis">0</h1>
						<h3 class="font-bold no-margins"><i class="fa fa-cubes"></i> 容器</h3>
						<h1 class="m-xs" id="containerCountsRedis">0</h1>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="ibox-content" style="border: 1px solid #cac5c5;border-radius: 5px; height: 273px; background:rgb(98, 162, 228);">
					<div>
						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-inbox"></i> CPU</span>  <br><h4 class="pull-right" id="cpuCountsRedis">0</h4>
						</div>

						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-building"></i> 内存</span> <br><h4 class="pull-right" id="memCountsRedis">0</h4>
						</div>

						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-hdd-o"></i> 存储空间</span>  <br><h4 class="pull-right" id="diskCountsRedis">0</h4>
						</div>

						<div class="right-resource">
							<span class="serv_font_15"><i class="fa fa-file-text"></i> 备份空间</span>  <br><h4 class="pull-right" id="backfilesCountsRedis">0</h4>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

</section>
<!-- end widget grid -->
<script src="js/echarts.min.js"></script>

<script src="js/spin.min.js"></script>
<script src="js/jquery.spin.js"></script>

<script src="js/util.js"></script>
<script type="text/javascript">
	if (typeof (flag) != "undefined") {
		clearInterval(flag);
	}
    loadScript("js/plugin/jqgrid/grid.locale-en.min.js", function(){
    	loadScript("js/plugin/jqgrid/jquery.jqGrid.min.js", function(){
    		loadScript("js/create-jqgrid.js", function(){
    			sendGetWithoutLayer("/" + getProjectName() + "/v1.0/servs?site="+getSession("siteId")+'&serv_type=upsql_upproxy_swm',createHomeUpsqlGrid,ListAlert,null);
    			sendGetWithoutLayer("/" + getProjectName() + "/v1.0/servs?site="+getSession("siteId")+'&serv_type=upredis_urproxy_sentinel',createHomeUpreidsGrid,ListAlert,null);
    		});
    	});
    });
    var userInfo = getSession('user');
    userInfo = JSON.parse(userInfo);
    var username = userInfo['username'];
    
    function fillServTableAll(data){
    	$("#memCountsAll").text((data.data['memCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#containerCountsAll").text(data.data['containerCounts']+"个");
    	$("#cpuCountsAll").text(data.data['cpuCounts']+"个");
    	$("#diskCountsAll").text((data.data['diskCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#backfilesCountsAll").text((data.data['backfilesCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#servCountsAll").text(data.data['servCounts']+"个");
    }
    
    function fillUpredisTable(data){
    	$("#memCountsRedis").text((data.data['memCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#containerCountsRedis").text(data.data['containerCounts']);
    	$("#cpuCountsRedis").text(data.data['cpuCounts']+"个");
    	$("#diskCountsRedis").text((data.data['diskCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#backfilesCountsRedis").text((data.data['backfilesCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#servCountsRedis").text(data.data['servCounts']);
    }
    
    function fillUpsqlTable(data){
    	$("#memCountsUpsql").text((data.data['memCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#containerCountsUpsql").text(data.data['containerCounts']);
    	$("#cpuCountsUpsql").text(data.data['cpuCounts']+"个");
    	$("#diskCountsUpsql").text((data.data['diskCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#backfilesCountsUpsql").text((data.data['backfilesCounts']/1024/1024/1024).toFixed(1)+" GB");
    	$("#servCountsUpsql").text(data.data['servCounts']);
    }
    
    sendGetWithoutLayer("/" + getProjectName() + "/v1.0/dashboards/user/"+username+"/serv_statistics?serv_type=upredis_urproxy_sentinel",fillUpredisTable,ListAlert,null);
    sendGetWithoutLayer("/" + getProjectName() + "/v1.0/dashboards/user/"+username+"/serv_statistics?serv_type=upsql_upproxy_swm",fillUpsqlTable,ListAlert,null);
    sendGetWithoutLayer("/" + getProjectName() + "/v1.0/dashboards/user/"+username+"/serv_statistics",fillServTableAll,ListAlert,null);
    
	var start_time = getTimeToday('start');
	var end_time = getTimeToday('end');
	sendGetWithoutLayer("/" + getProjectName() + "/v1.0/dashboards/"+getSession("siteId")+"/alarminfo?start_time="+start_time+"&end_time="+end_time,initAlarminfo,ListAlert,null);
	
	function initAlarminfo(data){
		$("#alarm_sended").text(data.data.alarm_sended);
		$("#alarm_nosend").text(data.data.alarm_nosend);
		$("#event_counts").text(data.data.event_counts);
	}
    
    var subservStatus_pie = echarts.init(document.getElementById('pie-main-chart'));
    function initSubservStatus(data){
    	 option = {
    	    	    title : {
    	    	        text: '数据库状态',
    	    	        subtext: '',
    	    	        x:'center',
    	    	        textStyle:{
    	    	    　　　　 	fontSize:24,
    	    	         	fontWeight:'normal'
    	    	        }
    	    	    },
    	    	    tooltip : {
    	    	        trigger: 'item',
    	    	        formatter: "{a} <br/>{b} : {c} ({d}%)"
    	    	    },
    	    	    color:['#1ab394','rgb(255, 219, 92)','rgb(253, 62, 62)','#23c6c8'],
    	    	    legend: {
    	    	        x : 'center',
    	    	        y : 'bottom',
    	    	        data:['正常','告警','异常','未知']
    	    	    },
    	    	    toolbox: {
    	    	        show : true,
    	    	        feature : {
    	    	            mark : {show: true},
    	    	            dataView : {show: false, readOnly: false},
    	    	            magicType : {
    	    	                show: true,
    	    	                type: ['pie', 'funnel']
    	    	            },
    	    	            restore : {show: false},
    	    	            saveAsImage : {show: true}
    	    	        }
    	    	    },
    	    	    calculable : true,
    	    	    series : [
    	    	        {
    	    	            name:'状态',
    	    	            type:'pie',
    	    	            radius : [20, 60],
    	    	            center : ['50%', '50%'],
    	    	            roseType : 'radius',
    	    	            label: {
    	    	                normal: {
    	    	                    show: false
    	    	                },
    	    	                emphasis: {
    	    	                    show: true
    	    	                }
    	    	            },
    	    	            lableLine: {
    	    	                normal: {
    	    	                    show: false
    	    	                },
    	    	                emphasis: {
    	    	                    show: true
    	    	                }
    	    	            },
    	    	            data:[
    	    	                {value:data.data.passing, name:'正常'},
    	    	                {value:data.data.warning, name:'告警'},
    	    	                {value:data.data.critical, name:'异常'},
    	    	                {value:data.data.unknown, name:'未知'}
    	    	            ]
    	    	        }
    	    	    ]
    	    };
    	 subservStatus_pie.setOption(option);
    }
    
    sendGetWithoutLayer("/" + getProjectName() + "/v1.0/dashboards/"+getSession("siteId")+"/subserv_status",initSubservStatus,ListAlert,null);
    
</script>